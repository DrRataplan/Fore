<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes" name="viewport">

    <title>xf-model test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/wct-mocha/wct-mocha.js"></script>

    <script src="../elements/xf-form.js" type="module"></script>
    <script src="../elements/xf-output.js" type="module"></script>
    <script src="../elements/xf-button.js" type="module"></script>
    <script src="../elements/xf-refresh.js" type="module"></script>
</head>
<body>


    <xf-form id="hello" mockup='[
          {
            "bind":{
              "id":"b-greeting",
              "value":"World"
            }
          }
        ]'>

        <h1>Hello
            <xf-output bind="b-greeting" id="greeting"></xf-output>
        </h1>
        <xf-button label="refresh">
            <xf-refresh id="refresh"></xf-refresh>
        </xf-button>

    </xf-form>

    <script type="module">
        suite('xf-refresh', () => {
            const form = document.getElementById('hello');
            const output = document.getElementById('greeting');
            const refresh = document.getElementById('refresh');

            test('output has value "World" before and after refresh', () => {

                assert.isTrue(output.modelItem.value === 'World');
                assert.isTrue(output.bind === 'b-greeting');
                assert.isTrue(output.modelItem.id === 'b-greeting');

                refresh.execute();

                assert.isTrue(output.modelItem.value === 'World');
                assert.isTrue(output.bind === 'b-greeting');
                assert.isTrue(output.modelItem.id === 'b-greeting');


            });

            test('refresh event fires', (done) => {

                const handler = (ev) => {
                    form.removeEventListener('refresh', handler);
                    done();
                };
                form.addEventListener('refresh',handler);
                refresh.execute();
            });

            test('refresh-done event fires', (done) => {

                const handler = (ev) => {
                    form.removeEventListener('refresh-done', handler);
                    done();
                };
                form.addEventListener('refresh-done',handler);
                refresh.execute();
            });


        });
    </script>

</body>
</html>
